<aside class="wiki-sidebar">
  <div class="wiki-sidebar-nav">
    <div class="wiki-sidebar-header">
      <h2 class="wiki-sidebar-title">
        <%= link_to root_path, class: "wiki-sidebar-title-link" do %>
          <img src="/icon.png" class="wiki-sidebar-logo" alt="">
          <span class="wiki-sidebar-title-text">LatinWiki</span>
        <% end %>
      </h2>
      <div class="wiki-sidebar-actions">
        <%= link_to "Search", search_path, class: "wiki-sidebar-action-link #{current_page?(search_path) ? 'wiki-sidebar-action-link--active' : ''}" %>
        <% if can_create_page? %>
          <%= link_to "Create", edit_doc_path(new: "1"), class: "wiki-sidebar-action-link #{controller_name == 'pages' && action_name == 'edit' && params[:new].to_s == '1' ? 'wiki-sidebar-action-link--active' : ''}" %>
        <% end %>
      </div>
    </div>
    <ul class="wiki-nav-list">
      <% pages_for_sidebar.each do |page| %>
        <%= render "pages/sidebar_item", page: page, current_page: local_assigns[:current_page] %>
      <% end %>
    </ul>
  </div>
  <div class="wiki-user-section">
    <% if current_user %>
      <details class="wiki-user-dropdown">
        <summary class="wiki-user-trigger">
          <% if current_user.avatar_url.present? %>
            <img src="<%= current_user.avatar_url %>" alt="" class="wiki-user-avatar" />
          <% else %>
            <span class="wiki-user-avatar-placeholder"><%= current_user.username&.first&.upcase || "?" %></span>
          <% end %>
          <div class="wiki-user-info">
            <span class="wiki-user-name"><%= current_user.name.presence || current_user.username %></span>
            <% if current_user.role_label.present? %>
              <span class="wiki-user-affiliation"><%= current_user.username %><span class="wiki-user-affiliation-sep"> • </span><%= current_user.role_label %></span>
            <% end %>
          </div>
          <span class="wiki-user-arrow">▼</span>
        </summary>
        <div class="wiki-user-menu">
          <%= link_to "Profile", user_path(current_user.username), class: "wiki-user-menu-item" %>
          <%= button_to "Log out", logout_path, method: :delete, class: "wiki-user-menu-item" %>
        </div>
      </details>
    <% else %>
      <%= button_to "Sign in with Google", "/auth/google_oauth2", method: :post, data: { turbo: false }, class: "wiki-sign-in-btn" %>
    <% end %>
  </div>
</aside>
